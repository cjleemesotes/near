<!doctype html>
<html lang="en" class="h-full" data-theme="dark">
<head>
<meta charset="utf-8">
<title>Fraud Guard – Every Frame · Provable Truth</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="color-scheme" content="dark light">

<!-- Alpine.js & Tailwind -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  darkMode:'[data-theme="dark"]',
  theme:{
    extend:{
      colors:{
        navy:'#0E1A2B', brand:'#2196F3',
        danger:'#E53935', success:'#14B97D',
        surface:'#162033', surfaceLight:'#f9fafb'
      },
      fontFamily:{sans:['Inter','sans-serif']}
    }
  }
}
</script>

<!-- Heroicons for copy icons -->
<script src="https://unpkg.com/heroicons@2.0.16/dist/24/outline.js"></script>

<style>
.card{border-radius:14px;box-shadow:0 3px 8px rgba(0,0,0,.25)}
/* tooltip */
.tooltip[data-show]{opacity:1;transform:translateY(0)}
.tooltip{opacity:0;pointer-events:none;transform:translateY(-4px);transition:.15s}
</style>
</head>

<body class="h-full font-sans" x-data="demo()" @keydown.escape="toast=''">

<!-- top bar -->
<header class="absolute top-0 inset-x-0 z-10">
  <div class="max-w-5xl mx-auto flex justify-between items-center p-3 text-xs">
    <!-- theme toggle -->
    <button @click="toggleTheme" aria-label="Toggle dark / light"
            class="p-1 rounded hover:bg-white/10 focus-visible:outline outline-2 outline-brand">
      <svg x-show="dark" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"/></svg>
      <svg x-show="!dark" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor"><path d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.071-7.071-1.414 1.414M8.343 8.343 6.929 6.929m10.122 10.122-1.414-1.414M8.343 15.657l-1.414 1.414" stroke-width="1.5" stroke="currentColor"/></svg>
    </button>
    <span class="hidden md:inline opacity-50">⌘A anchor · ⌘V verify · ⌘C copy ID</span>
  </div>
</header>

<!-- ROI ribbon -->
<div x-show="ribbon" x-transition.duration.300ms
     class="fixed top-0 inset-x-0 z-20 text-center py-2 font-medium bg-brand text-white">
  <span x-text="ribbon"></span>
</div>

<main class="min-h-full flex items-center justify-center py-20 px-4"
      :class="dark?'bg-navy text-white':'bg-surfaceLight text-navy'">

  <div class="max-w-5xl w-full grid md:grid-cols-[1fr_330px] gap-10">

    <!-- LEFT -->
    <section class="space-y-12">

      <!-- Hero -->
      <div class="text-center space-y-4">
        <!-- headline: mobile 5xl, md 6xl -->
        <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">
          Fraud Guard
        </h1>

        <!-- sub-headline: mobile lg, md 2xl -->
        <p :class="(dark?'text-brand/90':'text-brand') + ' text-lg md:text-2xl font-medium'">
          Cryptographic Evidence Authenticator for Insurance Fraud Detection
        </p>
      </div>

      <!-- timeline -->
      <nav class="flex justify-center gap-4" aria-label="Process steps">
        <template x-for="(l,idx) in ['Anchor','Verify','Flag']">
          <div class="flex flex-col items-center gap-1">
            <div class="w-3 h-3 rounded-full"
                 :class="step>idx ? 'bg-brand' : 'bg-white/25'"></div>
            <span class="text-[10px]" x-text="l"></span>
          </div>
        </template>
      </nav>

      <!-- STEP 1 -->
      <template x-if="step>=0">
      <div class="card p-8" :class="dark?'bg-surface':'bg-white'">

        <!-- full card until anchored -->
        <template x-if="step===0">
          <div>
            <h2 class="text-lg font-semibold mb-4">1&nbsp;· Anchor evidence</h2>
            <!-- file picker -->
            <label class="relative flex flex-col items-center justify-center h-32 border-2 border-dashed border-brand/40 rounded cursor-pointer hover:border-brand transition"
                   :class="file?'border-brand bg-brand/10':''">
              <input type="file" accept="video/*"
                     class="absolute inset-0 opacity-0"
                     @change="file=$event.target.files[0]" x-ref="anchorInput">
              <svg class="w-8 h-8 mb-2 text-brand" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M12 16V4m0 0L8 8m4-4 4 4M4 12h16M4 20h16"/></svg>
              <span x-text="file?file.name:'Click or drop video'"></span>
            </label>

            <button @click="anchor" :disabled="!file||busy"
                    class="w-full mt-6 py-3 rounded-lg bg-brand text-white font-medium disabled:opacity-20 flex items-center justify-center gap-2 focus-visible:outline outline-2 outline-offset-2 outline-brand">
              <span x-show="!busy">Anchor&nbsp;→ NEAR</span>
              <span x-show="busy" class="animate-spin h-5 w-5 border-2 border-white/50 border-t-transparent rounded-full"></span>
            </button>
          </div>
        </template>

        <!-- collapsed bar after anchor -->
        <template x-if="step>0">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-success text-white">✓</span>
              <span class="text-sm">Anchored</span>
            </div>
            <button @click="copyId" class="relative text-xs font-mono bg-brand/20 px-2 py-0.5 rounded hover:bg-brand/30"
                    aria-label="Copy Proof ID">
              <span x-text="anchorId"></span>
              <span x-ref="idTooltip" class="tooltip absolute top-full left-1/2 -translate-x-1/2 mt-1 bg-surface text-white text-[10px] px-1.5 py-0.5 rounded">Copied!</span>
            </button>
          </div>
        </template>
      </div>
      </template>

      <!-- preview -->
      <div x-show="previewUrl" x-transition
           class="card overflow-hidden" :class="dark?'bg-black':'bg-surfaceLight'">
        <video :src="previewUrl" preload="metadata" controls
               class="w-full bg-black object-contain"
               :poster="posterUrl"
               :class="verifying?'ring-4 ring-brand':''">
        </video>
      </div>

      <!-- STEP 2 card -->
      <template x-if="step===1">
      <div class="card p-8" :class="dark?'bg-surface':'bg-white'">
        <h2 class="text-lg font-semibold mb-4">2 · Verify authenticity by Proof ID</h2>

        <input x-model="verifyId" placeholder="Proof ID"
               class="w-full p-3 rounded bg-white/10 focus:outline-none focus:ring focus:ring-brand mb-4">

        <label class="relative flex flex-col items-center justify-center h-24 border-2 border-dashed border-brand/40 rounded cursor-pointer hover:border-brand transition"
               :class="fileVerify?'border-brand bg-brand/10':''">
          <input type="file" accept="video/*"
                 class="absolute inset-0 opacity-0"
                 @change="fileVerify=$event.target.files[0]" x-ref="verifyInput">
          <span x-text="fileVerify?fileVerify.name:'Choose video to verify'"></span>
        </label>

        <button @click="verify" :disabled="!verifyReady||busy"
                class="w-full mt-6 py-3 rounded-lg bg-emerald-500 text-white font-medium disabled:opacity-20 flex items-center justify-center gap-2 focus-visible:outline outline-2 outline-offset-2 outline-emerald-500">
          <span x-show="!busy">Verify ✓</span>
          <span x-show="busy" class="animate-spin h-5 w-5 border-2 border-white/50 border-t-transparent rounded-full"></span>
        </button>
      </div>
      </template>

    </section>

    <!-- RIGHT status panel -->
    <aside x-show="anchorId" x-transition role="status" aria-live="polite"
           class="card p-8 flex flex-col justify-between"
           :class="dark?'bg-surface':'bg-white'">

      <div>
        <span class="inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded"
              :class="statusChipClass" x-text="statusChip"></span>
        <h3 class="text-xl font-semibold mt-4" x-text="statusHeadline"></h3>
        <p class="text-sm opacity-80 mt-1" x-text="statusSub"></p>
      </div>

      <dl class="text-sm mt-6 space-y-1 border-t border-white/10 pt-4">
        <div class="flex justify-between items-center">
          <dt>Proof ID</dt>
          <dd class="flex items-center gap-1">
            <span class="font-mono" x-text="anchorId"></span>
            <button @click="copyId" aria-label="Copy ID" class="hover:text-brand">
              <svg class="w-4 h-4"><use href="#clipboard"/></svg>
            </button>
          </dd>
        </div>
        <div class="flex justify-between items-center">
          <dt>Root hash</dt>
          <dd class="truncate flex items-center gap-1">
            <span class="font-mono" x-text="rootHash.slice(0,8)+'…'"></span>
            <button @click="copyHash" aria-label="Copy hash" class="hover:text-brand">
              <svg class="w-4 h-4"><use href="#clipboard"/></svg>
            </button>
          </dd>
        </div>
        <div class="flex justify-between">
          <dt>Blockchain TX</dt>
          <dd><a :href="txUrl" target="_blank" class="text-brand underline">view ↗</a></dd>
        </div>
        <template x-if="diffFrame!==null">
          <div class="flex justify-between text-danger">
            <dt>Divergent frame</dt><dd x-text="diffFrame"></dd>
          </div>
        </template>
      </dl>

    <div class="text-center mt-8">
      <!-- make headline larger -->
      <p class="text-xl font-semibold opacity-70">Estimated Claim Value:</p>

      <p class="text-4xl font-extrabold text-brand" x-text="formattedSavings()">$0</p>
      <p class="text-xs mt-1" x-text="`${validatedCount} videos`"></p>
    </div>
    </aside>
  </div>
</main>

<!-- Toast -->
<div x-show="toast" x-transition.opacity
     class="fixed bottom-6 right-6 bg-danger/90 text-white px-4 py-2 rounded shadow-lg text-sm cursor-pointer z-20"
     role="alert" @click="toast=''" x-text="toast"></div>

<!-- Heroicons symbol -->
<svg style="display:none">
  <symbol id="clipboard" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="1.5">
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M16.5 4.5H18a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2v-13a2 2 0 0 1 2-2h1.5"/>
    <path stroke-linecap="round" stroke-linejoin="round"
          d="M15 2.5H9a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5Z"/>
  </symbol>
</svg>

<script>
const USD_PER_VIDEO = 50000;//2000
function demo(){
return{
  /* theme */
  get dark(){return document.documentElement.dataset.theme==='dark'},
  toggleTheme(){document.documentElement.dataset.theme=this.dark?'light':'dark'},

  /* state */
  step:0, file:null, fileVerify:null, busy:false, verifying:false,
  anchorId:'', rootHash:'', txUrl:'', verifyId:'', diffFrame:null,
  verifyOk:null, validatedCount:0, saved:0,
  previewUrl:'', posterUrl:'', toast:'', ribbon:'',
  statusChip:'Anchored', statusHeadline:'', statusSub:'',

  get verifyReady(){return this.verifyId.trim() && this.fileVerify},
  get statusChipClass(){
    return this.verifyOk===null
      ? 'bg-brand/20 text-brand'
      : this.verifyOk ? 'bg-success/20 text-success' : 'bg-danger/20 text-danger'
  },

  /* Helpers */
  showRibbon(msg){
    this.ribbon = msg;
    setTimeout(()=>this.ribbon='',50000);
  },

  async anchor(){
    if(this.busy)return;
    try{
      this.busy=true; this.toast=''; this.verifying=false;
      const fd=new FormData(); fd.append('video',this.file);
      const r=await fetch('/process-video',{method:'POST',body:fd});
      if(!r.ok) throw new Error(await r.text());
      const {id,root,tx}=await r.json();
      this.anchorId=id; this.rootHash=root; this.txUrl=`https://testnet.nearblocks.io/tx/${tx}`;
      this.statusChip='Anchored'; this.statusHeadline='Video notarised';
      this.statusSub='Immutable anchor set on‑chain';
      this.verifyId=id; this.previewUrl=URL.createObjectURL(this.file);
      this.step=1; this.showRibbon('Anchor set — disputes ↓ 90 %');
    }catch(e){this.toast=e.message}
    finally{this.busy=false}
  },

  async verify(){
    if(this.busy)return;
    try{
      this.busy=true; this.verifying=true; this.toast='';
      this.statusChip='Verifying'; this.statusHeadline=''; this.statusSub='';
      const fd=new FormData();
      fd.append('id',this.verifyId.trim());
      fd.append('video',this.fileVerify);
      const r=await fetch('/verify-video',{method:'POST',body:fd});
      if(!r.ok) throw new Error(await r.text());
      const {ok,firstBad}=await r.json();
      this.verifyOk=ok; this.diffFrame=ok?null:firstBad;
      if(ok){
        this.statusChip='Verified';
        this.statusHeadline='Integrity 100 %';
        this.statusSub='Perfect match with on‑chain root';
        this.validatedCount++; this.saved+=USD_PER_VIDEO;
        this.showRibbon('Protected payout: +$2 000');
      }else{
        this.statusChip='Mismatch';
        this.statusHeadline='Tampering detected';
        this.statusSub='Frame hashes diverge';
        this.showRibbon('Fraud averted — flag raised');
      }
      this.step=2;
    }catch(e){this.toast=e.message}
    finally{this.busy=false; this.verifying=false}
  },

  copyId(){
    navigator.clipboard.writeText(this.anchorId);
    this.flashTooltip(this.$refs.idTooltip);
  },
  copyHash(){
    navigator.clipboard.writeText(this.rootHash);
  },
  flashTooltip(el){
    el.setAttribute('data-show','');
    setTimeout(()=>el.removeAttribute('data-show'),800);
  },
  formattedSavings(){return `$${this.saved.toLocaleString('en-US')}`}
}}
</script>
</body>
</html>
